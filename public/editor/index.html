<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>JSONEditor</title>
  <link href="jsoneditor.min.css" rel="stylesheet" type="text/css">
  <script src="jsoneditor.min.js"></script>
  <script src="jsondb.js"></script>
  

  <style type="text/css">
    html { height:100%; margin:0; padding:0; }
    body { font: 10.5pt arial; color: #4d4d4d; line-height: 150%; width: 98%; height: 90%; padding:1%; margin:0; }
    code { background-color: #f5f5f5; }
    #jsoneditor { margin:0; width: 100%; height: 100%; }
    .button { display:inline-block; padding:2px 10px; background-color:#2656a3; color:#FFF; cursor:pointer; }
    .button:hover { opacity:0.8; }
  </style>
</head>
<body>
<div>
  <div id="but-save" class="button">SAVE</div>
  <input id="txt-filepath" type="text" style="width:70%; height:19px;">
  <div id="but-load" class="button">LOAD</div>
</div>
<div id="jsoneditor"></div>

<script>
  var $APP = {
    editor: null,
    init: async () => {
      filepath = document.location.search.replace("?","");
      document.querySelector("#txt-filepath").value = filepath;
      //https://github.com/josdejong/jsoneditor/blob/master/docs/api.md#configuration-options
      options = {
        mode: 'tree',
        modes: ['code', 'tree'], // allowed modes ['code', 'form', 'text', 'tree', 'view', 'preview']
        enableSort: false,
        enableTransform:false,
        templates: [
          {
            text: 'Wallet',
            value: {
              'name': 'Wallet',
              'address': '0x00000000',
              'chains':[{ 'chainId': 56, 'assets':[] }]
            }
          },
          {
            text: 'Chain',
            value: { 'chainId': 56, 'assets':[] }
          },
          {
            text: 'Asset',
            value: {
              'address': '0x00000000',
              'label': '',
              'symbol': '',
              'func': 'balanceOf',
              'params': ['_WALLET_ADDRESS_'],
              'output': -1,
              'calc':""
            }
          }
        ]
      }
      //https://defidata.link/track/data/contract/0xe9e7cea3dedca5984780bafc599bd69add087d56.json
      //json = await $T.api_get("https://s3.amazonaws.com/json.defidata.link/test.json");
      container = document.getElementById('jsoneditor');
      $APP.editor = new JSONEditor(container, options, {});
      if (filepath != "") {
        await $APP.load();
      }
    },
    save: async () => { 
      filepath = document.querySelector("#txt-filepath").value;
      data = $APP.editor.get();
      r = await jsondb.save(filepath, data);
      console.log(r);
    },
    load: async () => {
      filepath = document.querySelector("#txt-filepath").value;
      r = await jsondb.load(filepath);
      $APP.editor.set(r);
    }
  }
  $APP.init();

  document.querySelector("#but-save").addEventListener("click", $APP.save);
  document.querySelector("#but-load").addEventListener("click", $APP.load);
</script>
</body>
</html>
